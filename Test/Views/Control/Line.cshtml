@model Test.Models.LineView
@{
    ViewBag.Title = "Line History for " + Model.line.Name;
    Layout = "~/Views/Shared/_Layout2.cshtml";
    List<IHtmlString> buttons = new List<IHtmlString>() {
            Html.Bootstrap().SubmitButton().Text("Save").Id("saveline").Style(ButtonStyle.Success),new HtmlString(" "),
            Html.Bootstrap().SubmitButton().Text("Cancel").Id("cancel").Style(ButtonStyle.Default)
    };
    var current = Math.Abs(Model.when.Hour - DateTime.Now.Hour) < 8;
    var pending = (Model.conversions != null && Model.conversions.Count() > 0 && current);
}

@helper ButtonGroup()
{
using (var g = Html.Bootstrap().Begin(new ButtonGroup()))
{
        <div class=btn-group>
            @foreach (var b in Model.statuses)
            {
                @g.Button().Data(new { id = b.StatusId }).Class("linebtn btn-" + b.Color).Text(b.Pretty(Model.line.StatusId == b.StatusId))
            }
        </div>
}
}
<div class="container">
    @using (var form = Html.Bootstrap().Begin(new Form("SaveLine", "Control").Id("lineform").Type(FormType.Horizontal)))
    {
        @Html.HiddenFor(m => m.line.LineId)
        @Html.HiddenFor(m => m.line.ConversionId)
        @Html.HiddenFor(m => m.line.UnitId)
        @Html.HiddenFor(m => m.line.LineNumber)
        @Html.HiddenFor(m => m.line.StatusId)
        @Html.HiddenFor(m => m.action)

        <div class="row">
            <div class="col-md-12 text-primary"><h3>Assignment History of @Model.line.Name</h3></div>
        </div>
        <div class="row">
            <div class="col-md-10" id="lane"></div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <table id="lineactivity" class="table table-striped table-hover table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th colspan="6">Pending <span class="text-success">and Recent</span> Line Activity</th>
                        </tr>
                        <tr>
                            <th title="Ending Status"><i class='fa fa-gear'></i></th>
                            <th>Product</th>
                            <th>Time</th>
                            <th title="Solution System Assigned"><i class='fa fa-flask'></i></th>
                            <th>Note</th>
                            <th><i>Action</i></th>
                        </tr>
                    </thead>
                    <tbody>
                        @Html.DisplayFor(m => m.timeline)
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>
@section scripts{
<script src="~/Scripts/d3/d3.v2.js" type="text/javascript"></script>
<script src="~/Scripts/chart.js" type="text/javascript"></script>
<script src="~/Scripts/onelane.js" type="text/javascript"></script>
    <script type="text/javascript"> 
        $(document).on('contextready', function(e){
            oneline('#lane', @Model.line.LineId);
        });
    </script>
}

